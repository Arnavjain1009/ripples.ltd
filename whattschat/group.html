<!DOCTYPE html>
<html lang="en">

<head>
  <title>Group Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f2f2f2;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      padding: 4vw;
      background-color: #075e54;
      color: #ffffff;
      margin: 0;
    }

    #chat-container {
      flex: 1;
      max-width: 600px;
      margin: 0 auto;
      padding: 2vh;
      overflow-y: auto;
    }

    #chat-messages {
      list-style-type: none;
      padding: 0;
      margin: 0;
      max-height: 50vh;
      background-color: #f2f2f2;
      border: 1px solid #cccccc;
      border-radius: 8px;
    }

    li {
      border-bottom: 1px solid #cccccc;
      padding: 2vh;
    }

    #message-input-container {
      display: flex;
      align-items: center;
      margin-top: 2vh;
    }

    #message-input {
      flex: 1;
      padding: 2vh;
      border: 1px solid #cccccc;
      font-size: 3vw;
    }

    #send-button {
      padding: 2vh;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      width: 20vw;
      height: 7vh;
    }
  </style>
</head>

<body>
  <h1 id="group-name">Group Chat</h1>
  <div id="chat-container">
    <ul id="chat-messages"></ul>
    <div id="message-input-container">
      <input type="text" id="message-input" placeholder="Type your message...">
      <button onclick="sendMessage()" id="send-button">Send</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-database.js"></script>
  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyBP5fSB_kiakv0r-WMo7BkP2Ik70c26tT0",
      authDomain: "whattschat-f522c.firebaseapp.com",
      databaseURL: "https://whattschat-f522c-default-rtdb.firebaseio.com",
      projectId: "whattschat-f522c",
      storageBucket: "whattschat-f522c.appspot.com",
      messagingSenderId: "746097682908",
      appId: "1:746097682908:web:51a0278320ad4af5774719",
    };

    firebase.initializeApp(firebaseConfig);

    var database = firebase.database();
    var url_string = window.location.href;
    var url = new URL(url_string);
    var groupId = url.searchParams.get("groupId");
    var myuserid = url.searchParams.get("userid"); // Get user ID from URL

    var groupTitle = document.getElementById("group-name");

    // Fetch the group name from the database based on groupId
    var groupRef = database.ref("groups/" + groupId);
    groupRef.once("value", function(snapshot) {
      var groupData = snapshot.val();
      if (groupData && groupData.groupName) {
        groupTitle.innerText = "Group Chat - " + groupData.groupName;
      } else {
        groupTitle.innerText = "Group Chat";
      }
    });

    var messagesRef = database.ref("groups/" + groupId + "/messages");
    var chatMessages = document.getElementById("chat-messages");

    messagesRef.on("child_added", function(snapshot) {
      var message = snapshot.val();
      var listItem = document.createElement("li");
      listItem.textContent = message.sender + ": " + message.text;
      chatMessages.appendChild(listItem);
    });

    function sendMessage() {
      var messageInput = document.getElementById("message-input");
      var messageText = messageInput.value.trim();

      if (messageText !== "") {
        messagesRef.push({
          sender: myuserid, // Use user ID as sender
          text: messageText
        });

        messageInput.value = "";
      }
    }
  </script>
</body>

</html>
